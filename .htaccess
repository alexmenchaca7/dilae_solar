<IfModule mod_rewrite.c>
    RewriteEngine On

    # 1. Si la solicitud es para desplegar.php, la reescribe a su ubicación real y se detiene.
    RewriteRule ^desplegar\.php$ public/desplegar.php [L]

    # 2. Para todas las demás solicitudes, las envía a la carpeta /public para que el router las maneje.
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# --- Reglas de seguridad ---
Options -Indexes
<Files ".env">
    Require all denied
</Files>
<Files "composer.json">
    Require all denied
</Files>
<Files "composer.lock">
    Require all denied
</Files>
<Files "gulpfile.js">
    Require all denied
</Files>
<Files "package.json">
    Require all denied
</Files>
<Files "package-lock.json">
    Require all denied
</Files>
<IfModule mod_authz_core.c>
    <DirectoryMatch "^/(includes|models|controllers|classes|vendor|src|views)/">
        Require all denied
    </DirectoryMatch>
</IfModule>
<IfModule !mod_authz_core.c>
    <IfModule mod_access_compat.c>
        <DirectoryMatch "^/(includes|models|controllers|classes|vendor|src|views)/">
            Deny from all
        </DirectoryMatch>
    </IfModule>
</IfModule>