<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirigir sitemap.xml a sitemap.php
    RewriteRule ^sitemap\.xml$ sitemap.php [L]

    # Si la solicitud no es para un archivo o directorio que existe...
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    # ...redirígela a index.php para que el router de PHP la maneje.
    RewriteRule ^ index.php [L]
</IfModule>

# Prevenir el listado de directorios
Options -Indexes

<IfModule mod_headers.c>
    # 1. Fuerza la comunicación segura (HTTPS)
    # ¡ADVERTENCIA! Activa esta línea solo si tu SSL funciona perfectamente.
    # Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

    # 2. Protege contra ataques de tipo MIME sniffing
    Header always set X-Content-Type-Options "nosniff"

    # 3. Previene el clickjacking (que tu sitio sea metido en un <iframe> malicioso)
    Header always set X-Frame-Options "SAMEORIGIN"

    # 4. Controla qué recursos puede cargar el navegador (Política de Seguridad de Contenido)
    # Esta es una política de inicio. ¡DEBES PROBAR TU SITIO DESPUÉS DE APLICARLA!
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://embed.tawk.to https://analytics.dilaesolar.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self' https://embed.tawk.to wss://*.tawk.to; frame-src 'self'; object-src 'none'; upgrade-insecure-requests;"

    # 5. Controla el acceso a las APIs del navegador
    Header always set Permissions-Policy "geolocation=(), midi=(), notifications=(), push=(), sync-xhr=(), microphone=(), camera=(), magnetometer=(), gyroscope=(), speaker=(), vibrate=(), fullscreen=(self), payment=()"
</IfModule>